<div class="container">
	<h1>
		<%= @event.name %>
	</h1>

	<p>
		<b>Owner:</b>
		<%= @event.owner.email %>
	</p>
	<br>
	<h3>Availabilities: <%= @event.availabilities.distinct.count %></h3>

	<div >
	<% @dates.each do |d|%>
		<hr>
		<h3><%= d %></h3>
		<hr>
		<div class="availability-block">
		<% @availabilities.each do |a|%>
			<% if a.start.to_date == d%>
				<div style="margin:10px; padding:10px; border-radius:3px;
				<% if a.users.include?(current_user) %>
					color:black;
					background:lightblue;
				<% else %>
					background:grey;
				<% end %>
				">
					<%= a.start.strftime('%H:%M %p') %><br />
					<% a.users.each do |u| %>
						<%= u.email %><br />
					<% end %>

					<% if current_user%>
					<div class="buttons">
						<% if a.users.include?(current_user)%>
							<%= form_tag url_for(:controller => 'availabilities', :action => 'leave') do %>
								<%= hidden_field_tag :availability_id, a.id%>
								<%= hidden_field_tag :user_id, current_user.id%>
								<%= submit_tag("Leave", class: "btn btn-warning")%>
							<% end %>
						<% else %>
							<%= form_tag url_for(:controller => 'availabilities', :action => 'join') do %>
								<%= hidden_field_tag :availability_id, a.id%>
								<%= hidden_field_tag :user_id, current_user.id%>
								<%= submit_tag("Join", class: "btn btn-success")%>
							<% end %>
						<% end %>
					</div>
					<% end %>
				</div>
			<% end %>
		<% end %>
		</div>
	<% end %>
	</div>


	<% if current_user == @event.owner %>
		<h3> Admin Tools </h3>
		<p class="lead"> Event Name </p>
		<%= form_for @event, html: {class: 'form-inline'} do |f|%>
			<%= f.text_field :name, class: 'form-control', placeholder: 'Event Name', value: ''%>
			<%= f.submit "Change Name", class: 'btn btn-primary'%>
		<% end %>

		<br />
		<p class="lead"> Add Timeslot </p>
		<%= form_for Availability.new do |f| %>
			Start Time: <%= f.datetime_select :start, minute_step: 30, ampm: true %>
			<br />
			<br />
			End Time: <%= f.datetime_select :end, minute_step: 30, ampm: true %>
			<br />
			<br />
			<%= f.hidden_field :event_id, value: @event.id %>
			<%= f.submit "Add Timeslot", class: 'btn btn-info'%>
		<% end %>
		<br/>
		<p class="lead"> Edit Tasks </p>
		<table class="table table-striped">
			<thead>
				<th>Name</th>
				<th>Current Assignee</th>
				<th>Actions</th>
			</thead>
			<tbody>
				<% @tasks.each do |task| %>
					<tr>
						<td>task.name</td>
						<td>task.owner</td>
						<td>
							<%= link_to "Edit", edit_event_task_path, class: "btn btn-primary btn-warning btn-sm" %>
						</td>
					</tr>
				<% end %>
				<tr>
					<td colspan="2" class="lead">New Task</td>
					<td>
						<%= link_to "Add", new_event_task_path(@event), class: "btn btn-success" %>
					</td>
				</tr>
			</tbody>
		</table>
	<% end %>


</div>
